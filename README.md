# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types — папка с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Архитектура проекта «Веб-ларёк»

### Использованна архитектура MVP

Model - слой данных, реализующий их хранение и изменение
Viev - слой представления, реализующий отображение данных на странице
Present - презентер, отвечает за связь между слоем данных и представления

### О проекте
Проект реализует веб магазин для отображения товаров, добавления их в корзину и оформления заказов. Основная цель - создать модульную архитектуру, разделяющую бизнес логику, представление и управление состоянием через события.

## Данные и типы данных используемые в приложении

1) Товар
```
interface IProduct{
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```

2) Заказ
```
interface IOrder{
    payment: string;
    address: string;
    email: string;
    phone: string;
    total: number;
    items: IProduct[];
}
```

3) Результат заказа
```
interface OrderResult{
    id: string;
    total: number
}
```

4) Модель данных списка товаров
```
interface ICatalogModel{
    items: IProduct[];

    setItemList(items: IProduct[]): void;
    getItemList(): IProduct[]
    getItem(id: TProductId): IProduct
}
```

5) Модель данных заказа
```
interface IOrderModel{
    items: TBascketItem[]
    order: IOrder

    addProduct(item: TProductId): void
    remove(id: TProductId): void
    getTotal(): number
}
```

## Вспомогательные типы
```
//id продукта
type TProductId = Pick<IProduct, "id">

//товар в карзине
type TBascketItem = Pick<IProduct, "id" | "title" | "price">

// данные в форме оплаты
type TOrderPayment = Pick<IOrder, "payment" | "address">


//данные в форме контактов
type TOrderContacts = Pick<IOrder, "email" | "phone">

//ошибки валидации
type TFormErrors = Partial<Record<keyof IOrder, string>>
```
## Архитектура

### Базовый код

#### Класс API
Содержит в себе базовую реалезацию API.

В конструктор передается базовый адрес сервера и опциональный объект с заголовками
```
constructor(baseUrl: string, options: RequestInit = {})
```

Методы:
- `get` - выполняет GET запрос к серверу, по указанному в параметрах эндпоинту и возвращает промис с объектом прищедшем с сервера
```
get(uri: string)
```
- `post` - выполняет POST запрос к серверу, принимая в парамертрах эндпоинт, обьект, а также метод оптправки(по умолчанию "POST"). Возвращает промис с объектом прищедшем с сервера
```
post(uri: string, data: object, method: ApiPostMethods = 'POST')
```

#### Класс EventEmiter
Брокер событий. позволяет отправлять события и подписываться на них. Используется в слое представления для обработки событий и в слое данных для их отправки
Основыне методы описанны "IEvents"
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию при которой инициализируется требуеомое в параметрах событие 

### Слой данных

#### Класс Catalog
Класс отвечает за хранение и работы с данными карточек товара
Конструктор пиринимает брокер событий, а в полях класса храняться 
```
items: IProduct[]; //массив карточек товара
events: IEvents // экземпляр класса EventEmitter для инизицализации событий при изменении данных
```

Так же класс предоставляет набор методов для работы с этими данными
- `setItemList(items: IProduct[]): void;` - принимает массив карточек продукта и устанавливает их в items
- `getItemList(): IProduct[]` - отдает массив наших товаров
- `getItem(id: TProductId): IProduct` - получить `item` из `items` по `id` этого `items`

#### Класс Order
Отвечает за сохранение и работы с данными заказа
Конструктор пиринимает брокера событий, а в полях класса храняться
```
items: TBascketItem[]
order: IOrder
formErrors
events: IEvents // экземпляр класса EventEmitter для инизицализации событий при изменении
```

Также класс предоставляет набор методов для работы с этими данными
- `addProduct(item: TBascketItem): void`- добавляет продукт в корзину
- `removeProduct(id: TProductId): void` - убирает продукт по его id
- `getTotal(): number` - получает общее число продуктов в корзине
- `clearBascket(): void` - очищает корзину
- `clearDataForm(): void` - очищает данные из формы
- `setOrderPayment(fied: TOrderPayment, value: string): void` - получить данные о оплате
- `setOrderContacts(fied: TOrderContacts, value: string): void` - получить данные о контактах
- `validatePayment(): void` - проверка на валидность формы оплаты
- `validateContacts(): void` - проверка валидности формы контактов

### Слой представления

#### Класс Component
Имеет джинерик и является родителем всех компонентов слоя представления. В дженерик принимает тип объекта который потом передастся в render, для отображения данных. В конструктор принимает элемент разметки, являющийся родительским родительским контейнером компонента. Содержит метод render ответственный за сохранение полученых в параметре данных в полях компонента через сетеры. Возвращает обновленный контейнер компонента
Методы класса:

- `toggleClass` - переключение класса у элемента 
- `setText` - установить текст
- `setDisabled` - откючение/включение элемента
- `setHidden` - скрыть элемент
- `setVisible` - показать элемент
- `setImage` - задать изображение
- `render` - отрисовка эелемента


#### Класс Modal
Реализует отображение модального окна. Предоставляет методы open() и close(), для открытия и закрытия окна соответственно. Конструктор принимает HTMLElemnt в котором будет разметка содержимого модального окна, экземпрял класса EventEmitter для возможности инициировать события
Поля класса:
- `modal: HTMLElement` - разметка самого окна
- `events: IEvents` - брокер событий

#### Класс ProductCardView
Расширяет класс Component устанавливая в дженерик Iproduct. Реалезует карточки товара на главной странице. Конструктор принимает HTMLElemnt в котором будет размещена информация о товаре, а после возвращен готовый контейнер из рендер, экземпрял класса EventEmitter для возможности инициировать события. В render он передает объект типа дженерика для сохронения данных в поля класса что в конструкторе получают привязку к дом элементам

Поля класса:
- `itemId: string` - id товара
- `category: HTMLElement`- элемент карточки категория
- `title: HTMLElement`- элемент карточки заголовок
- `image: HTMLImageElement`- элемент карточки изображение
- `price: HTMLElement` - элемент карточки цена
- `description: HTMLElement` - элемент карточки описание
- `openButton: HTMLButtonElement`- элемент карточки кнопка для открытия карточки

#### Класс ProductCardPreView
Расширяет класс ProductCardView. При открытии модального окна отображает подробную информацию о товаре и кнопку добавления или удаления из корзины. Предоставляет методы для управления состояния кнопки. Конструктор принимает HTMLElemnt в котором будет размещена информация о товаре, а после возвращен готовый контейнер из рендер, экземпрял класса EventEmitter для возможности инициировать события. В этом классе рендер добавит в контейнер описание и кнопку и вернет его

Поля класса:
- `description: HTMLElement`
- `button: HTMLButtonElement` - кнопка купить/удалить из корзины

Методы класса: 
- `buttonStatus(isInBasket: boolean)` - изменяет текст на кнопке в зависимости от того в корзине ли товар
- `disabledButton(unplug: boolean)` - отключение кнопки при необходимости. К примеру если товар бесценен

#### Класс Basket
Расширяет класс Component. Предназначен для реализации модального окна корзины. Конструктор принимает HTMLElemnt в котором будет разметка содержимого модального окна, экземпрял класса EventEmitter для возможности инициировать события.

Поля Класса:
- `list`: HTMLElement - cписок товаров
- `total`: HTMLElement - цена за все в корзине
- `orderButton: HTMLButtonElement` - кнопка оформления

#### Класс BaketItem
Расширяет класс Component. Предназначен для реализации элемента товара модального окна корзины. Конструктор принимает HTMLElemnt в котором будет разметка содержимого модального окна, экземпрял класса EventEmitter для возможности инициировать события. Реалезация render стандартная (далее будет опускаться)

Поля класса:
- `itemId: string` - id товара
- `_count: HTMLElement` - элемент карточки порядковый номер
- `_title: HTMLElement` - элемент карточки название
- `_price: HTMLElement` - элемент карточки цена
- `deleteButton: HTMLButtonElement` - кнопка удаления из корзины

Методы:
- `setCounter(value: number)` - получает порядковый номер товара в корзине

#### Класс Page
Расширяет класс Component. Предназначен для реализации главной страницы с карточками товара и иконкой корзины. Конструктор принимает HTMLElemnt в котором будет разметка содержимого модального окна, экземпрял класса EventEmitter для возможности инициировать события

Поля класса:
- `elementCounter: HTMLElement` - счетчик количества товара в корзине
- `buttonBasket: HTMLButtonElement` - кнопка корзины
- `galleryCard: HTMLElement` - галерея карточек товара

Методы класса:
- `setLocked(value: boolean)` - блокирует страницу во время открытия модального окна

#### Класс Form
Расширяет класс Component. Реалезует форму. Инициализирует событие об изменении полей для дальнейшей валидации. Отправляет данные в модель по нажатию Submit'a и изменяет его состояние в зависимости от валидности

Поля класса:
- `_submit: HTMLButtonElement` - кнопка отправки данных формы
- `_errors: HTMLElement` - элемент, в котором отображаются ошибки при не валидности полей

Методы класса:
- `onInputChange(field: keyof T, value: string)` - защещенной метод. Инициализирует событие, при котором передаются данный поля и введенных в него данных.
#### Класс FormPaymen
Расширяет класс Form. Реализует форму заказа. Устанавливает значение полей. Сбрасывает содержимое полей, при закрытии модального окна.

Поля класса:
- `paymentButtons: NodeListOf<HTMLButtonElement>` - кнопки выбора способа оплаты
- `selectedPayment: string` - переменная, хранящая выбранный метод оплаты


Методы класса:
- `reset()` - сброс введенных данных формы

#### Класс FormContacts
Расширяет класс Form. Реализует форму контактов. Устанавливает значение полей и сбрасывает их при закрытии `reset()`

#### Класс FormSuccess
Оповещение об успеншой покупке

### Слой презентера

#### Класс WebLarekApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Файл index.ts связывает данные и интерфейс.
Он создаёт все нужные объекты и через события управляет их взаимодействием.

Список всех событий, которые могут генерироваться в системе:

События изменения данных (генерируются классами моделями данных)
- `productList:changed` - изменение списка карточек товара
- `formErrorsOrder:change` - изменение состояния валидации формы заказа
- `formErrorsContacts:change` - изменение состояния валидации формы контактов
- `/^order\..*:change/` - изменение одного из полей формы заказа
- `/^contacts\..*:change/` - изменение одного из полей формы контактов
- `totalUpdated` - обновление суммы заказа
- `order:ready` - поля формы заказа валидны
- `contacts:ready` - поля формы контактов валидны

События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `basket:open` - открытие модального окна с корзиной
- `product:open` - открытие модального окна с товаром
- `product:addBasket` - добавление товара в корзину
- `product:removeBasket` - удаление товара из корзины
- `basket:submit` - добавление товаров из корзины в заказ
- `order:submit` - добавление данных способа оплаты и адреса в заказ
- `contacts:submit` - добавление данных покупателя в заказ